{
  "info": {
    "name": "NestJS Multi-Tenant Boilerplate",
    "description": "Colección completa para probar el flujo multi-tenant con obras, materiales, bitácoras y asistencias",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "auth": {
    "type": "bearer",
    "bearer": [
      {
        "key": "token",
        "value": "{{accessToken}}",
        "type": "string"
      }
    ]
  },
  "item": [
    {
      "name": "1. Autenticación",
      "item": [
        {
          "name": "1.1 Login - Admin General",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response has token', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.token).to.be.a('string');",
                  "    pm.environment.set('accessToken', jsonData.token);",
                  "    pm.environment.set('refreshToken', jsonData.refreshToken);",
                  "    pm.environment.set('userId', jsonData.user.id);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"admin.general@ingenieria.com\",\n  \"password\": \"secret\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/login",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "login"]
            },
            "description": "Login con el administrador general que tiene acceso a todas las obras"
          }
        },
        {
          "name": "1.2 Login - Admin Obra 1",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response has token', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.token).to.be.a('string');",
                  "    pm.environment.set('accessToken', jsonData.token);",
                  "    pm.environment.set('refreshToken', jsonData.refreshToken);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"admin.obra1@ingenieria.com\",\n  \"password\": \"secret\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/login",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "login"]
            },
            "description": "Login con administrador que tiene acceso a 2 obras específicas"
          }
        },
        {
          "name": "1.3 Login - Usuario Regular",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response has token', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.token).to.be.a('string');",
                  "    pm.environment.set('accessToken', jsonData.token);",
                  "    pm.environment.set('refreshToken', jsonData.refreshToken);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"john.doe@example.com\",\n  \"password\": \"secret\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/login",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "login"]
            },
            "description": "Login con usuario regular del sistema"
          }
        },
        {
          "name": "1.4 Me - Información del usuario",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response has user data', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.email).to.be.a('string');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{accessToken}}",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/auth/me",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "me"]
            },
            "description": "Obtener información del usuario autenticado"
          }
        }
      ]
    },
    {
      "name": "2. Gestión de Obras",
      "item": [
        {
          "name": "2.1 Mis Obras - Listar",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response has obras', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.be.an('array');",
                  "    if (jsonData.length > 0) {",
                  "        pm.environment.set('obraId', jsonData[0].obra.id);",
                  "        pm.environment.set('obraName', jsonData[0].obra.nombre);",
                  "    }",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{accessToken}}",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/auth/my-obras",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "my-obras"]
            },
            "description": "Obtener todas las obras a las que el usuario tiene acceso"
          }
        },
        {
          "name": "2.2 Cambiar de Obra - Switch",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response has new token with obraId', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.token).to.be.a('string');",
                  "    pm.environment.set('accessToken', jsonData.token);",
                  "    pm.environment.set('refreshToken', jsonData.refreshToken);",
                  "    console.log('Nueva obra seleccionada: ' + pm.environment.get('obraName'));",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{accessToken}}",
                  "type": "string"
                }
              ]
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"obraId\": \"{{obraId}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/switch-obra",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "switch-obra"]
            },
            "description": "Cambiar a una obra específica. El nuevo token JWT incluirá el obraId en el payload."
          }
        },
        {
          "name": "2.3 Todas las Obras - Listar (Admin)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response has obras data', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data).to.be.an('array');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{accessToken}}",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/obras?page=1&limit=10",
              "host": ["{{baseUrl}}"],
              "path": ["obras"],
              "query": [
                {
                  "key": "page",
                  "value": "1"
                },
                {
                  "key": "limit",
                  "value": "10"
                }
              ]
            },
            "description": "Listar todas las obras (requiere permisos de administrador)"
          }
        },
        {
          "name": "2.4 Crear Nueva Obra",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 201', function () {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "pm.test('Response has obra data', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.id).to.be.a('string');",
                  "    pm.environment.set('newObraId', jsonData.id);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{accessToken}}",
                  "type": "string"
                }
              ]
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"nombre\": \"Obra de Prueba Postman\",\n  \"descripcion\": \"Obra creada desde Postman para testing\",\n  \"direccion\": \"Calle de Prueba 123, Ciudad\",\n  \"fechaInicio\": \"2025-11-03T00:00:00.000Z\",\n  \"administradorId\": {{userId}}\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/obras",
              "host": ["{{baseUrl}}"],
              "path": ["obras"]
            },
            "description": "Crear una nueva obra (requiere permisos de administrador)"
          }
        },
        {
          "name": "2.5 Asignar Usuario a Obra",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 201', function () {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "pm.test('Assignment created', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.id).to.exist;",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{accessToken}}",
                  "type": "string"
                }
              ]
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"userId\": {{userId}},\n  \"obraId\": \"{{obraId}}\",\n  \"roleId\": 2\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/obras/asignar-usuario",
              "host": ["{{baseUrl}}"],
              "path": ["obras", "asignar-usuario"]
            },
            "description": "Asignar un usuario a una obra con un rol específico"
          }
        }
      ]
    },
    {
      "name": "3. Materiales",
      "item": [
        {
          "name": "3.1 Listar Materiales de la Obra",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response has materiales', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data).to.be.an('array');",
                  "    if (jsonData.data.length > 0) {",
                  "        pm.environment.set('materialId', jsonData.data[0].id);",
                  "    }",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{accessToken}}",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/obras/{{obraId}}/materiales?page=1&limit=20",
              "host": ["{{baseUrl}}"],
              "path": ["obras", "{{obraId}}", "materiales"],
              "query": [
                {
                  "key": "page",
                  "value": "1"
                },
                {
                  "key": "limit",
                  "value": "20"
                }
              ]
            },
            "description": "Listar todos los materiales de la obra especificada en obraId"
          }
        },
        {
          "name": "3.2 Buscar Material por Nombre",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Filtered results', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data).to.be.an('array');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{accessToken}}",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/obras/{{obraId}}/materiales?filters[nombre]=$eq:Cemento",
              "host": ["{{baseUrl}}"],
              "path": ["obras", "{{obraId}}", "materiales"],
              "query": [
                {
                  "key": "filters[nombre]",
                  "value": "$eq:Cemento"
                }
              ]
            },
            "description": "Buscar materiales por nombre en la obra especificada"
          }
        },
        {
          "name": "3.3 Obtener Material por ID",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Material detail', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.id).to.be.a('string');",
                  "    pm.expect(jsonData.nombre).to.be.a('string');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{accessToken}}",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/obras/{{obraId}}/materiales/{{materialId}}",
              "host": ["{{baseUrl}}"],
              "path": ["obras", "{{obraId}}", "materiales", "{{materialId}}"]
            },
            "description": "Obtener detalles de un material específico de la obra"
          }
        },
        {
          "name": "3.4 Crear Material",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 201', function () {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "pm.test('Material created', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.id).to.be.a('string');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{accessToken}}",
                  "type": "string"
                }
              ]
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"nombre\": \"Material de Prueba\",\n  \"descripcion\": \"Material creado desde Postman\",\n  \"unidadMedida\": \"unidad\",\n  \"cantidadDisponible\": 100,\n  \"precioUnitario\": 25.50\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/obras/{{obraId}}/materiales",
              "host": ["{{baseUrl}}"],
              "path": ["obras", "{{obraId}}", "materiales"]
            },
            "description": "Crear un nuevo material para la obra especificada (obraId se toma del path)"
          }
        },
        {
          "name": "3.5 Actualizar Material",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Material updated', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.id).to.exist;",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{accessToken}}",
                  "type": "string"
                }
              ]
            },
            "method": "PATCH",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"cantidadDisponible\": 150,\n  \"precioUnitario\": 27.00\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/obras/{{obraId}}/materiales/{{materialId}}",
              "host": ["{{baseUrl}}"],
              "path": ["obras", "{{obraId}}", "materiales", "{{materialId}}"]
            },
            "description": "Actualizar información de un material existente en la obra"
          }
        }
      ]
    },
    {
      "name": "4. Bitácoras",
      "item": [
        {
          "name": "4.1 Listar Bitácoras de la Obra",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response has bitacoras', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data).to.be.an('array');",
                  "    if (jsonData.data.length > 0) {",
                  "        pm.environment.set('bitacoraId', jsonData.data[0].id);",
                  "    }",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{accessToken}}",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/obras/{{obraId}}/bitacoras?page=1&limit=20",
              "host": ["{{baseUrl}}"],
              "path": ["obras", "{{obraId}}", "bitacoras"],
              "query": [
                {
                  "key": "page",
                  "value": "1"
                },
                {
                  "key": "limit",
                  "value": "20"
                }
              ]
            },
            "description": "Listar todas las bitácoras de la obra especificada en obraId"
          }
        },
        {
          "name": "4.2 Filtrar por Fecha",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Filtered by date', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data).to.be.an('array');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{accessToken}}",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/obras/{{obraId}}/bitacoras?filters[fecha]=$gte:2025-11-01",
              "host": ["{{baseUrl}}"],
              "path": ["obras", "{{obraId}}", "bitacoras"],
              "query": [
                {
                  "key": "filters[fecha]",
                  "value": "$gte:2025-11-01"
                }
              ]
            },
            "description": "Filtrar bitácoras por fecha (mayor o igual a la especificada) en la obra"
          }
        },
        {
          "name": "4.3 Obtener Bitácora por ID",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Bitacora detail', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.id).to.be.a('string');",
                  "    pm.expect(jsonData.descripcion).to.be.a('string');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{accessToken}}",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/obras/{{obraId}}/bitacoras/{{bitacoraId}}",
              "host": ["{{baseUrl}}"],
              "path": ["obras", "{{obraId}}", "bitacoras", "{{bitacoraId}}"]
            },
            "description": "Obtener detalles de una bitácora específica de la obra"
          }
        },
        {
          "name": "4.4 Crear Bitácora",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 201', function () {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "pm.test('Bitacora created', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.id).to.be.a('string');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{accessToken}}",
                  "type": "string"
                }
              ]
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"descripcion\": \"Bitácora de Prueba - Entrada creada desde Postman\",\n  \"avance_porcentaje\": 15,\n  \"fecha\": \"2025-11-03T10:00:00.000Z\",\n  \"archivos\": []\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/obras/{{obraId}}/bitacoras",
              "host": ["{{baseUrl}}"],
              "path": ["obras", "{{obraId}}", "bitacoras"]
            },
            "description": "Crear una nueva entrada de bitácora para la obra especificada (obraId se toma del path)"
          }
        },
        {
          "name": "4.5 Actualizar Bitácora",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Bitacora updated', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.id).to.exist;",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{accessToken}}",
                  "type": "string"
                }
              ]
            },
            "method": "PATCH",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"descripcion\": \"Descripción actualizada desde Postman\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/obras/{{obraId}}/bitacoras/{{bitacoraId}}",
              "host": ["{{baseUrl}}"],
              "path": ["obras", "{{obraId}}", "bitacoras", "{{bitacoraId}}"]
            },
            "description": "Actualizar una entrada de bitácora existente en la obra"
          }
        }
      ]
    },
    {
      "name": "5. Asistencias",
      "item": [
        {
          "name": "5.1 Listar Asistencias de la Obra",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response has asistencias', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data).to.be.an('array');",
                  "    if (jsonData.data.length > 0) {",
                  "        pm.environment.set('asistenciaId', jsonData.data[0].id);",
                  "    }",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{accessToken}}",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/obras/{{obraId}}/asistencias?page=1&limit=20",
              "host": ["{{baseUrl}}"],
              "path": ["obras", "{{obraId}}", "asistencias"],
              "query": [
                {
                  "key": "page",
                  "value": "1"
                },
                {
                  "key": "limit",
                  "value": "20"
                }
              ]
            },
            "description": "Listar todas las asistencias de la obra especificada en obraId"
          }
        },
        {
          "name": "5.2 Filtrar por Estado",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Filtered by status', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data).to.be.an('array');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{accessToken}}",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/obras/{{obraId}}/asistencias?filters[estado]=$eq:presente",
              "host": ["{{baseUrl}}"],
              "path": ["obras", "{{obraId}}", "asistencias"],
              "query": [
                {
                  "key": "filters[estado]",
                  "value": "$eq:presente"
                }
              ]
            },
            "description": "Filtrar asistencias por estado (presente, ausente, tardanza) en la obra"
          }
        },
        {
          "name": "5.3 Obtener Asistencia por ID",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Asistencia detail', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.id).to.be.a('string');",
                  "    pm.expect(jsonData.estado).to.be.a('string');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{accessToken}}",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/obras/{{obraId}}/asistencias/{{asistenciaId}}",
              "host": ["{{baseUrl}}"],
              "path": ["obras", "{{obraId}}", "asistencias", "{{asistenciaId}}"]
            },
            "description": "Obtener detalles de una asistencia específica de la obra"
          }
        },
        {
          "name": "5.4 Crear Asistencia",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 201', function () {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "pm.test('Asistencia created', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.id).to.be.a('string');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{accessToken}}",
                  "type": "string"
                }
              ]
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"fecha\": \"2025-11-03\",\n  \"estado\": \"presente\",\n  \"observaciones\": \"Asistencia registrada desde Postman\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/obras/{{obraId}}/asistencias",
              "host": ["{{baseUrl}}"],
              "path": ["obras", "{{obraId}}", "asistencias"]
            },
            "description": "Registrar una nueva asistencia para la obra especificada (obraId se toma del path)"
          }
        },
        {
          "name": "5.5 Actualizar Asistencia",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Asistencia updated', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.id).to.exist;",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{accessToken}}",
                  "type": "string"
                }
              ]
            },
            "method": "PATCH",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"estado\": \"tardanza\",\n  \"notas\": \"Llegó 15 minutos tarde\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/obras/{{obraId}}/asistencias/{{asistenciaId}}",
              "host": ["{{baseUrl}}"],
              "path": ["obras", "{{obraId}}", "asistencias", "{{asistenciaId}}"]
            },
            "description": "Actualizar el estado de una asistencia existente en la obra"
          }
        }
      ]
    },
    {
      "name": "6. Activity Logs",
      "item": [
        {
          "name": "6.1 Listar Activity Logs de la Obra",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response has activity logs', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data).to.be.an('array');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{accessToken}}",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/logs?page=1&limit=20",
              "host": ["{{baseUrl}}"],
              "path": ["logs"],
              "query": [
                {
                  "key": "page",
                  "value": "1"
                },
                {
                  "key": "limit",
                  "value": "20"
                }
              ]
            },
            "description": "Listar todos los registros de actividad del sistema (solo Admin General)"
          }
        }
      ]
    },
    {
      "name": "7. Usuarios y Roles",
      "item": [
        {
          "name": "7.1 Listar Usuarios",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response has users', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data).to.be.an('array');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{accessToken}}",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/users?page=1&limit=10",
              "host": ["{{baseUrl}}"],
              "path": ["users"],
              "query": [
                {
                  "key": "page",
                  "value": "1"
                },
                {
                  "key": "limit",
                  "value": "10"
                }
              ]
            },
            "description": "Listar todos los usuarios del sistema (requiere permisos de admin)"
          }
        },
        {
          "name": "7.2 Listar Roles",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response has roles', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data).to.be.an('array');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{accessToken}}",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/roles",
              "host": ["{{baseUrl}}"],
              "path": ["roles"]
            },
            "description": "Listar todos los roles disponibles en el sistema"
          }
        }
      ]
    },
    {
      "name": "8. Tareas",
      "item": [
        {
          "name": "8.1 Listar Tareas de la Obra",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response has tareas', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.be.an('array');",
                  "    if (jsonData.length > 0) {",
                  "        pm.environment.set('tareaId', jsonData[0].id);",
                  "    }",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{accessToken}}",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/obras/{{obraId}}/tareas",
              "host": ["{{baseUrl}}"],
              "path": ["obras", "{{obraId}}", "tareas"]
            },
            "description": "Listar todas las tareas de la obra especificada"
          }
        },
        {
          "name": "8.2 Mis Tareas Asignadas",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response has my tareas', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.be.an('array');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{accessToken}}",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/obras/{{obraId}}/tareas/mis-tareas",
              "host": ["{{baseUrl}}"],
              "path": ["obras", "{{obraId}}", "tareas", "mis-tareas"]
            },
            "description": "Obtener las tareas asignadas al usuario autenticado en esta obra"
          }
        },
        {
          "name": "8.3 Tareas Asignadas a Usuario",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response has user tareas', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.be.an('array');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{accessToken}}",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/obras/{{obraId}}/tareas/asignadas/{{userId}}",
              "host": ["{{baseUrl}}"],
              "path": ["obras", "{{obraId}}", "tareas", "asignadas", "{{userId}}"]
            },
            "description": "Obtener tareas asignadas a un usuario específico"
          }
        },
        {
          "name": "8.4 Obtener Tarea por ID",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Tarea detail', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.id).to.be.a('string');",
                  "    pm.expect(jsonData.titulo).to.be.a('string');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{accessToken}}",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/obras/{{obraId}}/tareas/{{tareaId}}",
              "host": ["{{baseUrl}}"],
              "path": ["obras", "{{obraId}}", "tareas", "{{tareaId}}"]
            },
            "description": "Obtener detalles de una tarea específica"
          }
        },
        {
          "name": "8.5 Crear Tarea",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 201', function () {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "pm.test('Tarea created', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.id).to.be.a('string');",
                  "    pm.environment.set('tareaId', jsonData.id);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{accessToken}}",
                  "type": "string"
                }
              ]
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"titulo\": \"Instalación de estructura metálica\",\n  \"descripcion\": \"Instalar estructura principal del sector A según planos\",\n  \"prioridad\": \"alta\",\n  \"asignado_a_id\": 43,\n  \"fecha_inicio\": \"2025-11-05\",\n  \"fecha_vencimiento\": \"2025-11-15\",\n  \"progreso_porcentaje\": 0,\n  \"notas\": \"Coordinar con supervisor antes de iniciar\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/obras/{{obraId}}/tareas",
              "host": ["{{baseUrl}}"],
              "path": ["obras", "{{obraId}}", "tareas"]
            },
            "description": "Crear una nueva tarea en la obra (el creador se toma del JWT)"
          }
        },
        {
          "name": "8.6 Actualizar Tarea",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Tarea updated', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.id).to.exist;",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{accessToken}}",
                  "type": "string"
                }
              ]
            },
            "method": "PATCH",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"estado\": \"en_progreso\",\n  \"progreso_porcentaje\": 50,\n  \"notas\": \"Avance del 50% - En proceso de instalación\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/obras/{{obraId}}/tareas/{{tareaId}}",
              "host": ["{{baseUrl}}"],
              "path": ["obras", "{{obraId}}", "tareas", "{{tareaId}}"]
            },
            "description": "Actualizar el estado, progreso y otros campos de una tarea"
          }
        },
        {
          "name": "8.7 Completar Tarea",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Tarea completed', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.estado).to.equal('completada');",
                  "    pm.expect(jsonData.progreso_porcentaje).to.equal(100);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{accessToken}}",
                  "type": "string"
                }
              ]
            },
            "method": "PATCH",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"estado\": \"completada\",\n  \"progreso_porcentaje\": 100,\n  \"notas\": \"Tarea completada exitosamente\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/obras/{{obraId}}/tareas/{{tareaId}}",
              "host": ["{{baseUrl}}"],
              "path": ["obras", "{{obraId}}", "tareas", "{{tareaId}}"]
            },
            "description": "Marcar una tarea como completada con progreso al 100%"
          }
        },
        {
          "name": "8.8 Eliminar Tarea",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 204', function () {",
                  "    pm.response.to.have.status(204);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{accessToken}}",
                  "type": "string"
                }
              ]
            },
            "method": "DELETE",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/obras/{{obraId}}/tareas/{{tareaId}}",
              "host": ["{{baseUrl}}"],
              "path": ["obras", "{{obraId}}", "tareas", "{{tareaId}}"]
            },
            "description": "Eliminar una tarea de la obra"
          }
        }
      ]
    }
  ],
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:3000/api/v1",
      "type": "string"
    },
    {
      "key": "accessToken",
      "value": "",
      "type": "string"
    },
    {
      "key": "refreshToken",
      "value": "",
      "type": "string"
    },
    {
      "key": "userId",
      "value": "",
      "type": "string"
    },
    {
      "key": "obraId",
      "value": "",
      "type": "string"
    },
    {
      "key": "obraName",
      "value": "",
      "type": "string"
    },
    {
      "key": "materialId",
      "value": "",
      "type": "string"
    },
    {
      "key": "bitacoraId",
      "value": "",
      "type": "string"
    },
    {
      "key": "asistenciaId",
      "value": "",
      "type": "string"
    },
    {
      "key": "tareaId",
      "value": "",
      "type": "string"
    },
    {
      "key": "newObraId",
      "value": "",
      "type": "string"
    }
  ]
}
